<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phaser Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    class Example extends Phaser.Scene {
        preload() {
            // Load images from the local directory
            this.load.image('cowboy', 'assets/images/cowboy2.png');
            this.load.image('backgroundMain', 'assets/images/backgroundMain.png');
            this.load.image('bullet', 'assets/images/bullet1.png');
            this.load.image('worm', 'assets/images/worm1.gif');
        }

        create() {
            // Add the background image to cover the entire screen
            this.add.image(window.innerWidth / 2, window.innerHeight / 2, 'backgroundMain').setDisplaySize(window.innerWidth, window.innerHeight);

            // Add your cowboy character in the middle-bottom of the screen
            this.cowboy = this.physics.add.sprite(window.innerWidth / 2, window.innerHeight - 100, 'cowboy');
            this.cowboy.setCollideWorldBounds(true);
            this.cowboy.body.setGravityY(0);

            // Create input keys
            this.cursors = this.input.keyboard.createCursorKeys();
            this.wasd = {
                up: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),
                down: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),
                left: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),
                right: this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D)
            };
            this.spaceBar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

            // Create a group for bullets
            this.bullets = this.physics.add.group({
                classType: Phaser.Physics.Arcade.Image,
                maxSize: 10,
                runChildUpdate: true
            });

            // Create a group for worms
            this.worms = this.physics.add.group({
                classType: Phaser.Physics.Arcade.Image,
                runChildUpdate: true
            });

            // Create wave of worms
            this.time.addEvent({
                delay: 5000, // every 2 seconds
                callback: this.createWormWave,
                callbackScope: this,
                loop: true
            });

            // Add collision between bullets and worms
            this.physics.add.overlap(this.bullets, this.worms, this.hitWorm, null, this);
        }

        update() {
            this.cowboy.setVelocity(0);

            if (this.cursors.left.isDown || this.wasd.left.isDown) {
                this.cowboy.setVelocityX(-200);
                this.cowboy.setFlipX(false); // Face left
            } else if (this.cursors.right.isDown || this.wasd.right.isDown) {
                this.cowboy.setVelocityX(200);
                this.cowboy.setFlipX(true); // Face right
            }

            if (Phaser.Input.Keyboard.JustDown(this.spaceBar)) {
                this.shootBullet();
            }
        }

        shootBullet() {
            const bullet = this.bullets.get(this.cowboy.x, this.cowboy.y - 20, 'bullet');
            if (bullet) {
                bullet.setActive(true);
                bullet.setVisible(true);
                bullet.setVelocityY(-300);
            }
        }

        createWormWave() {
            for (let i = 0; i < 5; i++) {
                const worm = this.worms.create(Phaser.Math.Between(0, window.innerWidth), 0, 'worm');
                worm.setVelocityY(Phaser.Math.Between(50, 100));
                worm.health = 100; // Set worm health
            }
        }

        hitWorm(bullet, worm) {
            worm.health -= 35; // Bullet damage

            if (worm.health <= 0) {
                worm.setActive(false);
                worm.setVisible(false);
                worm.destroy();
            }

            bullet.setActive(false);
            bullet.setVisible(false);
            bullet.destroy();
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        scene: Example,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 50 } // Set global gravity to zero
            }
        },
        scale: {
            mode: Phaser.Scale.RESIZE,
            autoCenter: Phaser.Scale.CENTER_BOTH
        }
    };

    const game = new Phaser.Game(config);
    </script>

</body>
</html>
